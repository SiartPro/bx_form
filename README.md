# bx_form
Компонент формы

Распространяется под лицензией [MIT](https://en.wikipedia.org/wiki/MIT_License). Автор не принимает на себя никаких гарантийных обязательств в отношении данного компонента и не несет ответственности за:

  * любой прямой или косвенный ущерб и упущенную выгоду, даже если это стало результатом использования или невозможности использования компонента;
  * убытки, включая общие, предвидимые, реальные, прямые, косвенные и прочие убытки, включая утрату или искажение информации, убытки, понесенные Пользователем или третьими лицами, невозможность работы компонента и несовместимость с любым другим модулем, компонентом и т.д.
  * за любые повреждения оборудования или программного обеспечения Пользователя, возникшие в результате использовании компонента.

-----------------------------------
**Описание:**

Компонент реализует сохранение данных переданных из формы в информационный блок и отправку почтовым событием. Передача полей формы происходит посредством "AJAX" на ту же страницу, на которой была вызвана форма. Для этого необходимо указать в шаблоне компонента скрытое поле с именем "mode" и значением из "$arResult['HIDDEN']". Так же в компоненте проверяется актуальность сессии Битрикс, по этому после тега "form" необходимо результат работы функции вызова полей сессии "bitrix_sessid_post()". Примерный вид начала формы шаблона с включенной "google recaptcha v3":
```html
<form id="callback_form">
    <?= bitrix_sessid_post() ?>
    <input type="hidden" name="mode" value="<?= $arResult['HIDDEN'] ?>">
    **********
    <button
            id="modal_callback-btn"
            role="button"
            data-sitekey="<?= $arParams['RE_CAPTCHA_SITE_KEY'] ?>"
            data-callback="onCallbackSubmit"
            class="button--submit btn_transparent flex flex-center-vertical flex-center-horizontal g-recaptcha">
        <span>Отправить</span>
    </button>
</form>
```

В данный момент не реализован механизм настройки компонента в пользовательской части сайта посредством эрмитажа. Так же не реализовано сохранение и отправка файлов. Сделаю это позже. Ниже перечислен список параметров на данный момент.

-----------------------------------
**Примерный вид реализвции компонента на страницах:**
```php
<? $APPLICATION->IncludeComponent(
    'siart:simple.form',
    'callback',
    array(
        'IBLOCK_ID' => '15',
        'EVENT_NAME' => 'CALLBACK',
        'TITLE' => 'Новое обращение',
        'INCLUDE_URL' => 'Y',
        'RE_CAPTCHA_SITE_KEY' => RE_CAPTCHA_KEY1,
        'RE_CAPTCHA_SECRET_KEY' => RE_CAPTCHA_KEY2,
        'FIELDS' => array(
            'NAME',
            'PHONE'
        )
    ),
    false,
    array('HIDE_ICONS' => 'Y')
); ?>
```
**Перечень параметров:**

```php
'IBLOCK_ID'
```
_ID инфоблока в который необходимо сохранить полученные данные. Если не указан, то сохранения в инфоблок не будет._
```php
'EVENT_NAME'
```
_Символьный код почтового события, в которое будет переданы полученные данные. Если не указано, то отправки почты не будет._
```php
'TITLE'
```
_Название элемента инфоблока по умолчанию, если не передано поле "NAME". Если не заполнено, и отсутствует "NAME", то будет использоваться "Заполнена форма", так как поле с наименованием инфоблока обязательное._
```php
'INCLUDE_URL'
```
_Если передан параметр "Y", то в передаваемые из формы поля будет добавлено поле "URL" со ссылкой на страницу вызова формы в качестве значения._
```php
'RE_CAPTCHA_SITE_KEY'
```
_Если необходима "google recaptcha v3", то в этот параметр необходимо передать "ключ сайта"._
```php
'RE_CAPTCHA_SECRET_KEY'
```
_Если необходима "google recaptcha v3", то в этот параметр необходимо передать "секретный ключ". Так как эти ключи одни и те же для всего сайта, рекомендуется задавать их в виде констант. Если хотя бы один из ключей не передан, то recaptcha не будет использоваться. Подключается recaptcha способом "[Automatically bind the challenge to a button](https://developers.google.com/recaptcha/docs/v3#automatically_bind_the_challenge_to_a_button)" указанным в официальной документации. Код самой recaptcha подключается автоматически при необходимости в самом компоненте._
```php
'FIELDS'
```
_В этом параметре массив "name" полей формы которые будут использованы в шаблоне компонента. Значения соответствующие полям инфоблока, такие как 'NAME', 'SORT' 'PREVIEW_TEXT', 'DETAIL_TEXT', 'PREVIEW_PICTURE', 'DETAIL_PICTURE' будут записаны в инфоблок в виде полей, те которые не соответствуют - в виде свойств. Для приведённого выше примера массив параметров для создания элемента инфоблока будет выглядеть следующим образом:_
```php
array(
    'IBLOCK_ID' => '15',
    'NAME' => '****', //значение поля NAME формы либо TITLE настроек
    'PROPERTY_VALUES' => array(
        'PHONE' => '***', //значение поля PHONE
        'URL' => '****' //ссылка на страницу заполнения формы
    )
);
```
_В случае необходимости отправки писем эти поля будут переданы в почтовое событие._
